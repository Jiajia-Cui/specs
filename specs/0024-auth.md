Feature name: auth
Start date: 2019-12-11

# Summary
These specs will cover authentication of a party with the vega network.
We'll introduce a new tool to use with the vega network in order to allow a user to authenticate a transaction.
No implementation details will be covered.

In the a blockchain / decentralized / public world authentication is often done by pairing a payload with the corresponding cryptographic signature (e.g: a submitOrder transaction) that a user is sending to the application (in our case the vega network).
Creating a signature is often made by using a public key signature system (e.g:ed25519), which are compose of a private key (which the user need to keep secure) which will allow a user to sign a payload (basically a blob of bytes), and a public key derived from the private key (meant to be share with any actors in the system) used in order to verify a signature for a given payload. As the private key is meant to be used only by the owner of it, we can assume that if a signature can be verified, the original transaction was emitted by the owner of the private key.

This specification is meant to cover such feature for the vega network.


# Guide-level explanation

As a first version of the authentication, we do not expect the vega network itself to create the signature for a given transaction only to verify such signature, we expect the user to send any transction paired with the signature.
In order to facilitate this process we will provide a new service responsible for storing user private keys, and signing an arbitray blob of bytes (the actual transaction), requested by the user associated to a specific identity on the service, we can call this service a `wallet service`. This service will run separately from the node.
Users should log in to this service, and be able to choose one of their keys they wayt to use to sign their transactions

The vega network will require to implements a new command to be submitted to the chain in order to propagate a new public over the network. This should be initiated by the owner of the public private key.
Once this new command made it to a block, we would expect the whole network to be able to verify any signature from this user.

Any invalid transaction with an invalid signature should be rejected by the network.

# Reference-level explanation

## Wallet

The wallet should provide the following features:
	- Manage users (e.g: parties)
		- register a new party
		- signin, login, logout to the wallet (authentication method to be defined by implementation)
	- Manage private keys for a user
		- create a key pair for a user.
		- list all public key for a user
		- delete a key pair ?
	- Sign blob of data
		- accept a request from a authenticated user containing a blob of data and reference to a private key to be used to sign the blob

## Network

The network will need to implement a new command to send through the chain.
	- This command will propage a newly created public key through the network, so it can be used to identify new transactions, and verify signatures
	- The public key should be associated to some kind of identifier (e.g:partyID used in orders etc), it could be an address derived from the public key.

The network will also need to verify signature for all transactions.
When to verify them will need to be decided and profile as verifying transaction will be at some cost for the nodes, but ideally we should:
	- Verify a signature for a transaction before it's sent to the chain so we can stop a transction to be proposed to the chain if it's an invalid signature
	- Verify a signature for a transaction after it's added to the block for security as well.


# Pseudo-code / Examples
TBD

# Acceptance Criteria
Wallet service acceptance criteria
- [] As a user, I can create a new account on the Wallet service (account creation requirement to be implementation details)
- [] As a user, I can login to the Wallet service with my account
- [] As a user, I can logout of the Wallet service with my account
- [] As a user, if I'm logged in, I can create a new key pair for for my account on the Wallet service.
- [] As a user, if I'm logged in, I can list all my public keys on the Wallet service
- [] As a user, if I'm logged in, I can delete a existing key pair from the Wallet service
- [] As a user, if I'm logged in, I can create a signature for a blob of data, using one of the key pairs.

Vega network acceptance criteria
- [] As a user, I can send a transction to the vega blockchain to propagate a new public key that I own/
- [] As a user, I can send a transaction to the vega network with a signature for it.
- [] As a vega node, I ensure that all transaction are paired with a signature.
  - [] A signature is verified before the transaction is sent to the chain.
	- [] If a signature is valid, the transaction is sent to the chain
	- [] If a signature is invalid, the transaction is not sent to the chain, an error is returned
  - [] A signature is verified after the transaction is addedto the chain.
	- [] If a signature is valid the transaction is processed
	- [] If a signature is invalid the transaction is discarded.


# Test cases
TBD
