
# WIP Fees on Vega

## Collecting fees

In general the trading fee can be (we could have more general non-affine functions but I don't see why):

fee = "fee offset" + "fee factor" x notional.

Fees are collected in the settlement currency of the market. The "fee offset" is non-negative fixed amount (network parameter?) while the "fee factor" is set as part of the market making staking mechanism (market makers submit their preferred fee factor and their stake-weighted average determines the fee factor). N.B. "fee factor" is per market. 

### During Continous Trading

The "aggressor" pays the fee to the "liquidity provider" which, here, are the participants that placed passive orders on the book (limit orders, special MM limit order, ...). Of course, since a market order may be hitting more that one order this has to be split correctly per volume taken from each limit order. 

The whole fee should be collected from the "aggressor". 

Part of the fee (network parameter?) is immediately credited to the "liquidity provider".The remainder of the fee should be transferred to the "market fee pool" (another account similar to but separate from market insurance pool). 

### Position Resolution 

During position resolution the "network" is the party whose position is being liquidated should be seen as the aggressor and their fee collected as in continuous trading for the aggressor. So if their margin balance can cover the fee then it comes from their margin balance, otherwise the fee will come from the market insurance pool.  

### Auction

During auctions there is no "aggressor" and no "liquidity provider". Each side in a matched trade should contrinute 1/2 of the fee amount. The fee amount should be transferred to the "market fee pool". 

## Distributing fees

The market fee pool has now collected some amount in fees.

Fees should be distributed periodically (could be any period but I would advocate immediately).

As far as I can see, during continuous trading, this should happen after the closeout trades are executed but before new batch of trades are matchd.

During auction mode, I would think that fees can be distributed immediately after the end of auction period (which, if I understand, will result in a bunch of trades).

The "trade liquidity providers" already got their cut earlier, so the only parties with claim to what's in the market fee pool are the node operators and market makers for the market.

A fraction (network parameter?) should be distributed to the node operators (proportionally to the number of Vega tokens they hold and tokens others have delegated to them). This amount should go to a per-staking-node account that however the node operators cannot access immediately (because we may wish to slash their rewards if they are mis-behaving, are not performant enough, have too much stake etc. separate spec to come). For now it is enough that this is a separate account where each staking node operator can see how much has been earned so far.  

The remainder is split between market makers based on their time-weighted market-making stake (another spec).
