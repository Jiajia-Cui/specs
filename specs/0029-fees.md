
# WIP Fees on Vega

## Collecting fees

In general the trading fee can be (we could have more general non-affine functions but I don't see why):

fee = "fee offset" + "fee factor" x CalculationAmount

Fees are collected in the settlement currency of the market. The "fee offset" is non-negative fixed amount (network parameter?) also set the settlement currency of the market. The "fee factor" is set as as a separate mechanism, and may update regularly.

Initially, for futures, the CalculationAmount = notional volume of the trade = size_of_trade * price_of_trade

### During Continuous Trading

The "price taker" of each trade pays the fee. An order may cross with more than one order and each trade incurs a fee. NOTE: we need to figure out how the "fee offset" is incurred for multiple trades.

Part of the fee (network parameter?) is immediately credited to the "price maker". A portion of the remainder of the fee (set by a network parameter) should be transferred to the "market fee pool" (another account similar to but separate from market insurance pool). A portion of the remainder of the fee (set by a network parameter) should be transferred to the "infrastructure fee pool".

### Position Resolution 

During position resolution the "network" is the party whose position is being liquidated should be seen as the aggressor and their fee collected as in continuous trading for the aggressor. So if their margin balance can cover the fee then it comes from their margin balance, otherwise the fee will come from the market insurance pool.  

### Auction

During auctions there is no "price maker" and no "price taker". Each side in a matched trade should contribute 1/2 of the fee amount. The fee amount should be transferred to the "market fee pool". 

## Distributing fees

The market fee pool has now collected some amount in fees.

Fees should be distributed periodically (could be any period but I would advocate immediately).

As far as I can see, during continuous trading, this should happen after the closeout trades are executed but before new batch of trades are matched.

During auction mode, I would think that fees can be distributed immediately after the end of auction period (which, if I understand, will result in a bunch of trades).

The "price makers" already got their cut earlier, so the only parties with claim to what's in the market fee pool are the node operators and market makers for the market.

A fraction (network parameter?) should be distributed to the node operators (proportionally to the number of Vega tokens they hold and tokens others have delegated to them). This amount should go to a per-staking-node account that however the node operators cannot access immediately (because we may wish to slash their rewards if they are mis-behaving, are not performant enough, have too much stake etc. separate spec to come). For now it is enough that this is a separate account where each staking node operator can see how much has been earned so far.  

The remainder is split between market makers based on their time-weighted market-making stake (another spec).

## Acceptance Criteria
